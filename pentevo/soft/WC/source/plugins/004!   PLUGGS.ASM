;GS Player v0.1;(C) BUDDER/MGN/2012;---------------------------------------        ORG #6000;-------ABT     EQU #6004ENT     EQU #6005WLD     EQU #6006;---------------------------------------;HEADER:        DS 16        DB "WildCommanderMDL";    Header        DB #01;                  Version        DB 0;                       Type        DB 1; Pages        DB 0; Page to #8000;-------        DB 0,5; CODE.5      DB 0,0;-------        DS 16;-------        DB "MOD"        DB "WAV"        DS 30*3;-------        DB 0;-------        DW #FFFF,#FFFF; MAX SIZE;-------        DB "GS Player v0.1  "        DB "                ";-------        DB 0;---------------------------------------        ORG #8000,#6200;-------LOBU    EQU #A000;---------------------------------------PLUGIN  LD (DAHL),HL,(DADE),DE        LD L,H,H,E.3      SRL D:RR H,L        INC L:JR NZ,$+3:INC H        LD (BLKZ),HL        XOR A        LD (ESTAT),A        LD H,A,L,A        LD (TMM),HL        CALL DEVCHE:RET Z        LD A,(GSENA):CP #FF:CALL Z,GSFET        LD A,(GSENA):OR A:JP NZ,NOGS        CALL GEDPL        LD IX,PLWND:CALL PRWOW        CALL EXTCHE:JR Z,MODMUZ        DEC A:JP Z,WAVMUZ        LD A,2:OUT (254);-------MODMUZ_LD IX,PLWND_LD HL,TXT01,DE,#000C,BC,11:CALL PRSRW        LD A,%11110111:CALL PRIAT        CALL GOGS        XOR A:LD (ZNAK),A,(POZA),AMAIN    EI:HALT        CALL CLOCK        CALL GWC,NC,PTC:JR NC,NEXT        CALL SPKE:JR NZ,GAFF        CALL ESC:JR NZ,GAFF        CALL ENKE:JR Z,MAINNEXT    LD A,2,(ESTAT),AGAFF    LD IX,PLWND:CALL RRESBGAF     LD A,(ESTAT)        RET;-------NOGS    LD A,1,(ESTAT),A:JR GAF;---------------------------------------TMMI    LD HL,(TMM):INC HL:LD (TMM),HL        RET;---------------------------------------PTC     CALL TMMI        LD HL,ZNAK        LD A,(HL):OR A:JR NZ,NNC        LD A,#60:OUT (#BB),A        LD (HL),APOF     SCF        RETNNC     LD (HL),0        IN A,(#B3)        LD HL,POZA        CP (HL):LD (HL),A:JR NC,POF        XOR A        RET;---------------------------------------GOGS    CALL PBSHW_LD IX,PLWND_LD HL,TXT4,DE,#0101,BC,10:CALL PRSRW_LD A,%01110010:CALL PRIAT        XOR A:CALL SENDCOM        LD A,#F3:CALL SENDCOM;REini        LD A,#23:CALL SENDCOM,GETDAT        EXA        LD A,#30:CALL SENDCOM;sndMOD        LD A,#D1:CALL SENDCOM;opnSTRM        EXA        LD DE,6,H,D,L,A.4      ADD HL,HL        ADD HL,DE        LD A,(BLKZ+1):CP H        JR NZ,ZEM        LD B,A:LD A,(BLKZ):CP L:LD A,B        JR Z,NOIZEM     JR NC,BRKANOI     OR A:JR Z,NANOIR    PUSH AF        LD B,0:CALL GSLOAD        POP AF        DEC A:JR NZ,NOIRNA      LD A,(BLKZ),B,A        CALL GSLOAD        CALL PBHTW        LD A,#D2:CALL SENDCOM        IN A,(#B3):OUT (#B3),A        LD A,#31:CALL SNDCOM        CALL GIPAGPL        LD HL,LOBU,B,1:CALL LOAD512        LD HL,LOBU,DE,TXT2        LD BC,12:LDIR_LD IX,PLWND_LD HL,TXT1,DE,#0101,BC,10:CALL PRSRW_LD A,%01110001:CALL PRIAT_LD HL,TXT2,DE,#010B,BC,12:CALL PRSRW        RETBRKA    LD A,#D2:CALL SENDCOM        RET;---------------------------------------GSLOAD  PUSH BC        CALL PBPR        LD HL,LOBU,B,4:CALL LOAD512        LD HL,LOBU        LD BC,#00BB,E,2TE1     IN A:RLCA:JR C,TE1RDA     LD A,(HL):OUT (#B3),A:INC LTE2     IN A:RLCA:JR C,TE2RDB     LD A,(HL):OUT (#B3),A:INC LTE3     IN A:RLCA:JR C,TE3RDC     LD A,(HL):OUT (#B3),A:INC LTE4     IN A:RLCA:JR C,TE4RDD     LD A,(HL):OUT (#B3),A:INC HL        DJNZ TE1        DEC E:JR NZ,TE1        POP BC        DJNZ GSLOAD        RET;-------SNDCOM  OUT (#BB),A:RETSENDCOM OUT (#BB),AGSWC    IN A,(#BB)        RRCA        JR C,GSWC        RETGWC     IN A,(#BB)        RRCA        RET;-------SENDDAT OUT (#B3),AGSWD    IN A,(#BB):RLCA:JR C,GSWD        RET;-------GETDAT  IN A,(#BB):RLCA:JR NC,GETDAT        IN A,(#B3)        RET;---------------------------------------GSFET   IN A,(#B3)        LD B,0,C,ASTAB    IN A,(#B3):CP C:JR NZ,WSE        DJNZ STAB        LD A,#F3:OUT (#BB),A        LD B,0:DJNZ $        LD A,#23:OUT (#BB),A        LD BC,#0F00DIK     DEC BC:LD A,B:OR C:JR Z,WSE        IN A,(#BB)        RRCA        JR C,DIK        IN A,(#B3):CP 3:JR C,WSEWNE     LD A,1:OUT (#B3),A        LD A,#6A:CALL SENDCOM        XOR A:OUT (#B3),A        LD A,#6B:CALL SENDCOM        XOR A;-------WZE     LD (GSENA),A        PUSH AF:LD A,#F3:CALL SENDCOM        POP AF        RETWSE     LD A,1:OR A        JR WZE;---------------------------------------WAVMUZ_LD IX,PLWND_LD HL,TXT02,DE,#000C,BC,11:CALL PRSRW        LD A,%11110111:CALL PRIATGOWAV   CALL PBSHW        LD HL,ENTRY,DE,TXT2,BC,8:LDIR        LD A,".",(DE),A:INC DE        LD C,3:LDIR_LD IX,PLWND_LD HL,TXT3,DE,#0101,BC,10:CALL PRSRW_LD A,%01110001:CALL PRIAT_LD HL,TXT2,DE,#010B,BC,12:CALL PRSRW        LD HL,LOBU,B,1:CALL LOAD512        LD BC,(LOBU+24);4 BYTES!;-------        LD HL,8000,DE,#0504        OR A:SBC HL,BC:JR Z,GC;-------        LD HL,11025,DE,#0403        OR A:SBC HL,BC:JR Z,GC;-------        LD HL,16000,DE,#0302;TMP        OR A:SBC HL,BC:JR Z,GC;-------        LD HL,22050,DE,#0102        OR A:SBC HL,BC:JR Z,GC;-------        LD HL,44100,DE,#0101;   37.5KHz!        OR A:SBC HL,BC:JR Z,GC;-------GC      LD A,(LOBU+22)        LD HL,#0000:CP 1:JR Z,CHANLZ        LD HL,#7E23:CP 2:JR Z,CHANLZCHANLZ  LD (TOGS+5),HL;STEREO        LD (TOGS+3),DE;FREQKHZ     XOR A        OUT (#B3),A        OUT (#BB),A        IN A,(#BB)        LD A,#F3:CALL SENDCOM        LD A,#00:OUT (#B3),A        LD A,#14:CALL SENDCOM,GSWD        LD A,#02:CALL SENDDAT        LD A,#00:CALL SENDDAT        LD A,#40:CALL SENDDAT        LD HL,TOGS,BC,#0200WAV2    PUSH BC        LD A,(HL):CALL SENDDAT:INC HL        POP BC        DEC BC:LD A,B:OR C:JR NZ,WAV2        XOR A:OUT (#B3)        LD A,#13:CALL SENDCOM,GSWD        LD A,#40:CALL SENDDAT        XOR A:OUT (#BB),A        IN A,(#B3)        XOR A        LD (WVMD),A        LD A,32        LD (MINB),A        LD A,(BLKZ+1):OR A:JR Z,MNI        LD B,ABIG     LD C,0BG      PUSH BC:LD B,1:CALL GSLOAD        POP BC        LD HL,MINB        LD A,(HL):OR A:JR Z,FFF        DEC (HL)        XOR A        LD (ABT),A        LD (ENT),A        JR HHHFFF     LD A,(ENT):OR A:JR NZ,NXWV        LD A,(ABT):OR A:JR NZ,EXWVHHH     DEC C:JR NZ,BG        DJNZ BIGMNI     LD A,(BLKZ):OR A:JR Z,EDWV        LD B,A:CALL GSLOAD        LD A,1,(WVMD),AEDWV    LD A,#FF:CALL SENDCOM        CALL PBHTW        CALL ENKE        LD A,(WVMD):OR A:JP Z,GAFF        JP NEXT;-------NXWV    LD A,1,(WVMD),AEXWV    LD A,#FE        JR EDWV+2;---------------------------------------PBSHW   LD HL,(DAHL)        LD DE,(DADE)        CALL DEL32        LD (PBSTL+1),HL        LD (PBSTH+1),DE        LD HL,0,(PBNOW),HL,(PBNOW+2),HL        RET;-------PBHTW   EI.4      HALT_LD IX,PLWND_LD HL,TXT32,DE,#0201,BC,32:CALL PRSRW        RET;-------PBPR    LD HL,(PBNOW)        LD DE,(PBNOW+2)        LD BC,2048        ADD HL,BC:JR NC,$+3:INC DE        LD (PBNOW),HL        LD (PBNOW+2),DE        CALL DELIT4P        LD HL,TXTBU        LD C,32        OR A:JR NZ,$+5:LD A,C:JR DoL        CP C:JR C,$+3:LD A,C        LD B,A        LD A,C:SUB B        LD C,#DB        LD (HL),C:INC HL:DJNZ $-2        OR A:JR Z,DOLDoL     LD B,A,C,#B1        LD (HL),C:INC HL:DJNZ $-2DOL_LD IX,PLWND_LD HL,TXTBU,DE,#0201,BC,32:CALL PRSRW        RET;---------------------------------------CLOCK   LD HL,(TMM),DE,CLOK        LD BC,50*60,A,255        OR A:INC A:SBC HL,BC:JP NC,$-3        LD (DE),A:INC DE        ADD HL,BC        LD BC,50,A,255        OR A:INC A:SBC HL,BC:JP NC,$-3        LD (DE),A:INC DE        ADD HL,BC        LD A,L:ADD A,A        LD (DE),A        LD HL,TIME+0_LD A,(CLOK+0):CALL DEC0        LD (HL),C:INC HL:LD (HL),A        LD HL,TIME+3_LD A,(CLOK+1):CALL DEC0        LD (HL),C:INC HL:LD (HL),A        LD HL,TIME+6_LD A,(CLOK+2):CALL DEC0        LD (HL),C:INC HL:LD (HL),A_LD IX,PLWND_LD HL,TIME,DE,#0119,BC,8:CALL PRSRW_LD A,%01110000:CALL PRIAT        RETDEC0    LD C,#2F        INC C:SUB 10:JR NC,$-3        ADD A,10+#30        RET;---------------------------------------DEL32.5      SRL D:RR E,H,L        RETDELIT4P LD IX,0-1NAZE    OR APBSTH   LD BC,0:INC IX        EX DE,HL:SBC HL,BC:JR C,NDPBSTL   LD BC,0        EX DE,HL:SBC HL,BC:JR NC,PBSTH        DEC DE        LD A,D:INC A:JR NZ,NAZE        LD A,E:INC A:JR NZ,NAZE        INC DE        ADD HL,BC        EX DE,HL        LD BC,(PBSTH+1)ND      ADD HL,BC        EX DE,HL        PUSH IX        POP BC        LD A,C        RET;---------------------------------------EXTCHE  PUSH HL,DE        CALL TENTRY;-------        LD HL,ENTRY+8,DE,MOD        CALL TN:LD A,0:JR Z,YUKSEK        LD HL,ENTRY+8,DE,WAV        CALL TN:LD A,1:JR Z,YUKSEK        LD HL,ENTRY+8,DE,RAW        CALL TN:LD A,2:JR Z,YUKSEK        LD A,#FF;-------YUKSEK  POP DE,HL        OR A        RET;---------------------------------------TN_LD A,(DE):CP (HL):RET NZ:INC HL,DE_LD A,(DE):CP (HL):RET NZ:INC HL,DE_LD A,(DE):CP (HL)        RET;---------------------------------------DEVCHE  LD A,(IX+29):CP 2:RET NZ        CALL GEDPL        LD IX,ERWND:CALL PRWOW_LD HL,TXTER,DE,#0103,BC,26:CALL PRSRW        CALL USPO        CALL NUSP        CALL RRESB        XOR A        RET;---------------------------------------PRWOW   LD A,1:JP WLDRRESB   LD A,2:JP WLDPRSRW   LD A,3:JP WLDPRIAT   EXA:LD A,4:JP WLD;-------GEDPL   LD A,15:JP WLD;-------SPKE    LD A,16:JP WLDENKE    LD A,22:JP WLDESC     LD A,23:JP WLDUSPO    LD A,46:JP WLDNUSP    LD A,47:JP WLD;-------LOAD512 LD A,48:JP WLDGIPAGPL LD A,50:JP WLDTENTRY  LD DE,ENTRY,A,51:JP WLD;---------------------------------------PLWND   DB 0,0        DB 23,13;    X,Y        DB 32+2,2+2; W,H        DB %01111111;PAPER+INK        DB 0        DW #0000;    BUFFER        DB 0,0;      LINES;-------ERWND   DB 0,0        DB 23,13;    X,Y        DB 32+2,1+2; W,H        DB %00101111;PAPER+INK        DB 0        DW #0000;    BUFFER        DB 0,0;      LINES;-------TXTER   DB "CAN'T PLAY FROM SD(NGS)!!!"TXT01   DB "MOD Player:"TXT02   DB "WAV Player:"TXT1    DB "Song Name:"TXT3    DB "File Name:"TXT4    DB "Loading..."TXT2    DS 32;---------------------------------------MOD     DB "MOD"WAV     DB "WAV"RAW     DB "RAW";-------DAHL    DS 2DADE    DS 2BLKZ    DS 2PBNOW   DS 4GSENA   DB #FFMINB    NOPZNAK    NOPPOZA    NOPWVMD    NOP;-------TMM     DS 2CLOK    DS 3TIME    DB "00:00.00";-------ESTAT   NOP;---------------------------------------ENTRY   DS 32TXT32   DS 32,32TXTBU   DS 32END;---------------------------------------;---------------------------------------TOGS    ORG #4000,#6200+(END-PLUGIN)        DI:JR GONPEI     DB 2        DB 1STO     DB #00,#00GON     LD HL,I_n_T,(#5EFF),HL        LD A,#5E,I,A        IM 2;---------------------------------------        LD A,63        OUT (#07),A        OUT (#08),A;     6,7,8,9=A,B,C,D        LD HL,PEI        LD A,(HL),(PE1+1),A:INC HL        LD A,(HL),(PE2+1),A        LD HL,(STO),(STEREO),HL        EXX:LD BC,#0100,HL,#8000,D,#61        EXX;---------------------------------------LOADE   LD A,1,(PAGR+1),ALDE     LD HL,PAGR+1:INC (HL)        LD A,(HL),DE,(MXP)        CP E:JR NC,TYU        OUT (#00),A        LD HL,#8000        CALL PGLD        JR LDETYU     OUT (#00),A        LD A,2,(PAG+1),A        EIWAIT    LD HL,#8000        LD BC,#02WAITGS  IN A,(#01):OR A:JR NZ,EXIT        IN A,(#04)        RLCA:JR NC,WAITGS        INI        LD A,H:OR L:JR NZ,WAITGS        LD H,#80;L=0        LD A,(PAGR+1),DE,(MXPG)        INC A:CP E:JR C,$+4:LD A,2        LD (PAGR+1),A,E,AKL      LD A,(PAG+1):CP E:JR Z,KL        JP WAITGSEXIT    INC A:JR NZ,FUCK        IN ANFIR    LD A,(PAGR+1),E,AEXT     LD A,(PAG+1):CP E:JR Z,NXS        LD A,H:CP #80:JR C,EXT        LD (HL),0:INC HL        JR EXTNXS     LD A,(PAG+1):CP E:JP NZ,#0000        JR NXS;-------FUCK    IN A        JP #0000;---------------------------------------I_n_T   EXX:EXA        DJNZ NOSND        LD A,C:OR A:JR NZ,K1PE2     LD B,4:INC C        JR PAGK1      CP 1:JR NZ,K2        INC C        JR $+4K2      LD C,0PE1     LD B,3PAG     LD A,2:OUT (#00),A        LD A,(HL)        LD (DE),A:INC DSTEREO  NOP:NOP        LD (DE),A        LD A,(DE):DEC D        LD A,(DE)        INC L:JR Z,POZPAGR    LD A,2:OUT (#00),ANOSND   EXX:EXA        EI        RETPOZ     INC H:JR NZ,PAGR        LD A,(MXPG),E,A,A,(PAG+1)        INC A:CP E:JR C,$+4:LD A,2        LD (PAG+1),A        LD H,#80        JR PAGR;---------------------------------------PGLD    IN A,(#04)        RLCA:JR NC,PGLD        IN A,(#02)        LD (HL),A:INC HL        LD A,H:OR L        JR NZ,PGLD        RET;---------------------------------------INDEX   DW 0SND     DB 0MXPG    DB 64MXP     DB 4;---------------------------------------